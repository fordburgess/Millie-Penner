<div>
    <div class="flex items-center" style="z-index: 30; position: absolute; top: 10px; right: 10px;">
        <% if @current_cart.zines.length > 0 %>
            <p><%= @current_cart.zines.length %></p>
        <% end %>
        <%= image_tag "cart.png", id: "cart-icon", class: "h-8 w-8 hover:cursor-pointer" %>
    </div>    
    <div id="cart-sidebar" class="h-screen w-[33vw] absolute right-0 bg-zinc-800 p-8 bg-opacity-90" style="transform: translateX(100%);">
        <div id="inner-cart" class="h-full flex flex-col justify-between">
            <div>
                <h1 class="font-lexendZetta text-3xl font-bold text-white mb-8">My Cart</h1>            
                <% @current_cart.zines.each do |zine| %>
                    <div class="flex text-white mb-6 relative">
                        <%= image_tag zine.cover_image, class: "mr-4", style: "max-height: 10rem; max-width: 5rem" %>
                        <div class="font-kameron">
                            <h2 class="mt-0 mb-4"><%= zine.title %></h2>
                            <p>Price: Â£<%= sprintf('%.2f', zine.price) %></p>
                        </div>
                        <%= button_to "X", remove_from_cart_path(zine), :method => :delete, class: "absolute top-0 right-0 hover:cursor-pointer" %>
                    </div>
                <% end %>
            </div>
            <% if @current_cart.zines.length > 0 %>
                <div class="flex flex-col">
                    <%= link_to "Checkout", new_order_path, class: 'classic-button-1 w-full mb-4 text-center' %>                               
                    <%= button_to "Clear all", empty_cart_path, :method => :delete, class: "classic-button-1 w-full bg-black text-white" %>
                </div>
            <% end %>
        </div>
    </div>    
</div>

<script type="text/javascript">
    document.addEventListener('turbo:load', () => {
        var cartIcon = document.getElementById("cart-icon");        
        var cartSidebar = document.getElementById("cart-sidebar");
        var cartOpen = false;

        cartIcon.addEventListener('click', (e) => {    
            e.stopPropagation();
        
            if (cartSidebar.style.transform == 'translateX(100%)') {
                cartSidebar.style.transform = 'translateX(0%)';   
                cartOpen = true;         
            }
        })

        document.addEventListener('click', (e) => {
            if (cartOpen) {
                if (!cartSidebar.contains(e.target)) {                    
                    cartSidebar.style.transform = 'translateX(100%)'
                    cartOpen = false;
                }
            }
        })
    })
</script>
